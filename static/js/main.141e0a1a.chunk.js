(this["webpackJsonpfantasy-slots"]=this["webpackJsonpfantasy-slots"]||[]).push([[0],{15:function(e,t,a){},17:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a.n(n),c=a(8),r=a.n(c),s=(a(15),a(18)),o=a(3),l=0,d=1,u=2,f=3,g=f,j=a.p+"static/media/key.0629d73b.png",m=a.p+"static/media/chest1.b4054229.png",b=a.p+"static/media/chest2.d4ed67d0.png",h=a.p+"static/media/chest3.888bf5be.png",v=a.p+"static/media/chest4.28dffa1b.png",p=a.p+"static/media/coal.d3a30adc.png",x=a.p+"static/media/coin.3480412c.png",O=a.p+"static/media/dagger1.6892c2d5.png",y=a.p+"static/media/pickaxe.9f91b8f2.png",T=a.p+"static/media/rock.14a2b8aa.png",k={state:{gameData:null,spinning:!1,tilesToPick:[],selectedTile:null},_update:function(e){},update:function(){k._update(Math.random())}};window.store=k;var D=a(0);function A(e){var t=e.image,a=e.tileName;return Object(D.jsx)("img",{className:"icon",src:t,alt:"",onClick:function(){var e=ue(a||"");e&&(k.state.selectedTile=fe(e),k.update())}})}var C=function(){return Object(D.jsx)(A,{image:m})},V=function(){return Object(D.jsx)(A,{image:b})},N=function(){return Object(D.jsx)(A,{image:h})},S=function(){return Object(D.jsx)(A,{image:v})},w=function(){return Object(D.jsx)(A,{image:p,tileName:"Coal"})},P=function(){return Object(D.jsx)(A,{image:x})},E=function(){return Object(D.jsx)(A,{image:y,tileName:"Pickaxe"})};function M(e,t){var a=e.getAdjacentIndexes();e.getTiles(a).forEach(t)}var I=[{id:"48217c09-300c-44b0-803e-19f51346227b",name:"Coal",icon:w,rarity:l,categories:[],calculateValue:function(e){var t=1;return M(e,(function(e){"Coal"===e.config.name&&(t+=1)})),t}},{id:"2f2e6e35-686f-4033-9940-3f66a153c568",name:"Dagger",icon:function(){return Object(D.jsx)(A,{image:O})},rarity:l,categories:[],calculateValue:function(e){return 1}},{id:"49d24981-a7d1-4407-b121-ed3e45d427bd",name:"Coin",icon:P,rarity:l,categories:[],calculateValue:function(e){return 1}}],R=a(5);function B(e,t){return e.config.categories.includes(t)}var H=a(1);function W(e,t){return Math.floor(Math.random()*(t-e+1))+e}var J="9c0617fc-daf3-4f9c-943e-073f698ac0b8";function F(){var e=localStorage["".concat(J)];e=e?JSON.parse(e):{};var t=JSON.parse(JSON.stringify(k.state.gameData));z(t.ownedTiles),z(t.deckTiles),z(t.gameTiles),e.gameState=t,e.saveDate=new Date,localStorage["".concat(J)]=JSON.stringify(e)}function z(e){var t,a=Object(H.a)(e);try{for(a.s();!(t=a.n()).done;){var n=t.value;n.config={id:n.config.id}}}catch(i){a.e(i)}finally{a.f()}}var U=[{totalDays:0,taxAmount:0},{totalDays:5,taxAmount:25},{totalDays:6,taxAmount:50},{totalDays:7,taxAmount:100},{totalDays:8,taxAmount:200},{totalDays:9,taxAmount:400},{totalDays:10,taxAmount:800}];function _(e,t){return e.find((function(e){return e.config.id===t}))}function G(e){var t=k.state.gameData.gameTiles,a=t.findIndex((function(e){return e.config.id===ce.id}));a>=0?t.splice(a,1,e):t.push(e)}function K(e,t){var a,n=e.reduce((function(e,a){return a.config.rarity<=t&&e.push(a),e}),[]);return(a=n)[W(0,a.length-1)]}function L(){for(var e=k.state.gameData,t=e.deckTiles,a=[],n=0;n<5;n++){var i=K(t,l);a.push(fe(i.config))}e.gameTiles=a,Q()}function Q(){for(var e=k.state.gameData,t=e.gameTiles,a=e.gridWidth,n=e.gridHeight,i=0;t.length<a*n;i++)t.push(fe(ce))}function X(){var e=k.state.gameData,t=e.gridWidth,a=e.gridHeight,n=e.deckTiles;e.boardTiles=function(){for(var e=k.state.gameData,t=e.gameTiles,a=e.gridWidth,n=e.gridHeight,i=[],c=Object(o.a)(t),r=0;r<a*n;r++){var s=Math.floor(Math.random()*c.length),l=c[s],d=t.indexOf(l);i.push(d),c.splice(s,1)}return i}(),function(){for(var e=k.state.gameData,t=e.gridWidth,a=e.gridHeight,n=e.gameTiles,i=e.boardTiles,c=0;c<t*a;c++)n[i[c]].data.spinValue=0}(),k.state.gameData.gameTiles.forEach((function(e){e.data.totalSpins++})),k.state.spinning=!0,k.update();var i=0,c=setInterval((function(){var r=e.boardTiles,s=e.gameTiles;i>0&&i<=t*a&&(s[r[i-1]].data.highlight=!1);if(i>t*a)return clearInterval(c),k.state.spinning=!1,k.state.gameData.totalCoins+=k.state.gameData.boardValue,k.state.tilesToPick=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=Object(o.a)(e),n=[];console.log("Picking tiles");for(var i=function(e){var t=q(a),i=t.chances,c=t.chanceTotal,r=W(0,c),s=i.findIndex((function(e){return e>=r}));console.log({chances:i,chanceTotal:c,rand:r,index:s});var o=a.splice(s,1)[0];o&&n.push(fe(o.config))},c=0;c<t;c++)i(c);return n}(n),k.update(),$(),void F();if(i<t*a){var l=s[r[i]];l.data.highlight=!0,l.data.totalAppearances++,l.data.spinValue=function(e,t){var a=k.state.gameData,n=a.gridWidth,i=a.gridHeight,c={tile:e,gameData:a,getAdjacentIndexes:function(){return function(e,t,a){var n=[];n.push(e+t),n.push(e-t),n.push(e+1),n.push(e-1),n.push(e+t-1),n.push(e+t+1),n.push(e-t-1),n.push(e-t+1);for(var i=7;i>=0;i--)Y(e,n[i],t,a)||n.splice(i,1);return n}(t,n,i)},getTiles:Z};return e.config.calculateValue(c)}(l,i)}i++;var d,u=0,f=Object(H.a)(r);try{for(f.s();!(d=f.n()).done;){u+=s[d.value].data.spinValue}}catch(g){f.e(g)}finally{f.f()}k.state.gameData.boardValue=u,k.update()}),100)}function Y(e,t,a,n){return!(t<0||t>=a*n)&&((e+1!==t&&e-1!==t||Math.floor(t/a)===Math.floor(e/a))&&((e+a+1!==t&&e+a-1!==t||Math.floor(t/a)===Math.floor((e+a)/a))&&(e-a+1!==t&&e-a-1!==t||Math.floor(t/a)===Math.floor((e-a)/a))))}function Z(e){var t=k.state.gameData,a=t.boardTiles,n=t.gameTiles;return e.map((function(e){return n[a[e]]}))}function q(e){var t,a=[],n=0,i=Object(H.a)(e);try{for(i.s();!(t=i.n()).done;){var c=t.value;n+=g+1-c.config.rarity,a.push(n)}}catch(r){i.e(r)}finally{i.f()}return{chances:a,chanceTotal:n}}function $(){var e=k.state.gameData,t=U[e.currentTaxPeriod];e.currentTaxPeriodDay++,e.currentTaxPeriodDay>=t.totalDays&&(e.currentTaxPeriod++,e.currentTaxPeriodDay=1,e.totalCoins-=t.taxAmount,e.totalCoins<0&&(e.roundEnded=!0)),k.update()}function ee(e){var t=e.message,a=void 0===t?"":t;k.state.gameData.events.push({id:Object(s.a)(),message:a}),console.log("GAME EVENT: ".concat(a))}function te(e,t){var a;e.config.onRemove&&(a=e.config.onRemove(t));var n=t.gameData.gameTiles,i=n.indexOf(e),c=fe(ce);if(a){var r=a.tiles;if(null===r||void 0===r?void 0:r.length){c=r[0];for(var s=1;s<r.length;s++)G(r[s])}a.value&&(c.data.spinValue=a.value)}n[i]=c}function ae(e){var t=e.baseValue,a=e.removeValue;return{categories:["chest"],description:function(){return Object(D.jsxs)(D.Fragment,{children:["Unlocked by the key, gives ",a," ",Object(D.jsx)(P,{})]})},calculateValue:function(e){return t},onRemove:function(e){return{value:a}}}}var ne=[{id:"2ef31449-bf1d-4cee-8e93-e0665fb9942a",name:"Key",description:function(){return Object(D.jsxs)(D.Fragment,{children:["The key unlocks ",Object(D.jsx)(C,{})," ",Object(D.jsx)(V,{})," ",Object(D.jsx)(N,{})," ",Object(D.jsx)(S,{}),", destroying both in the process"]})},icon:function(){return Object(D.jsx)(A,{image:j,tileName:"Key"})},rarity:l,categories:["key"],calculateValue:function(e){var t=!1;return M(e,(function(a){B(a,"chest")&&(te(a,e),t=!0)})),t&&te(e.tile,e),1}},Object(R.a)({id:"834bf40d-0a3d-4e20-83a0-4e3aa233840c",name:"Small Chest",icon:C,rarity:l},ae({baseValue:1,removeValue:10})),Object(R.a)({id:"c87ea7e4-5479-4aa7-9033-0859d191390b",name:"Medium Chest",icon:V,rarity:d},ae({baseValue:2,removeValue:20})),Object(R.a)({id:"8abbd4fc-1fee-4c14-b5c2-2a627de70dd1",name:"Large Chest",icon:N,rarity:u},ae({baseValue:3,removeValue:30})),Object(R.a)({id:"3422f3a8-bd1a-4549-a9ff-d0ed0621d646",name:"Dark Chest",icon:S,rarity:f},ae({baseValue:4,removeValue:40}))],ie=[{id:"102f6200-dd6b-434f-b486-67ccc425cc4d",name:"Pickaxe",description:function(){return Object(D.jsx)(D.Fragment,{children:"Breaks rocks, has 3 uses"})},icon:E,rarity:l,categories:["mining"],createMeta:function(){return{uses:3}},topStat:function(e){return e.meta.uses},calculateValue:function(e){var t=!1;return M(e,(function(a){t||B(a,"rock")&&(te(a,e),console.log(e.tile.meta),e.tile.meta.uses--,0===e.tile.meta.uses&&(t=!0,ee({message:"A Pickaxe broke"})))})),t&&te(e.tile,e),1}},{id:"89c89fb8-b343-4767-ba9f-78b4586b4ceb",name:"Rock",description:function(){return Object(D.jsxs)(D.Fragment,{children:["Broken by ",Object(D.jsx)(E,{}),", gives one of ",Object(D.jsx)(w,{})]})},icon:function(){return Object(D.jsx)(A,{image:T,tileName:"Rock"})},rarity:l,categories:["rock"],calculateValue:function(e){return 1},onRemove:function(e){var t=fe(le.get("Coal"));return ee({message:"A broken Rock yielded a ".concat(t.config.name)}),{tiles:[t]}}}],ce={id:"04f5df2c-22d6-4e31-8e81-c81f0ba1c4c1",name:"Empty",icon:function(){return Object(D.jsx)(A,{image:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"})},rarity:l,categories:["empty"],calculateValue:function(e){return e.tile.data.spinValue||0}},re=[].concat(Object(o.a)(I),Object(o.a)(ne),Object(o.a)(ie),[ce]),se=re,oe=new Map,le=new Map,de=[];function ue(e){var t=le.get(e);return t||console.error(new Error('Tile name "'.concat(e,'" not found'))),t}function fe(e,t){var a;return e||(console.error(new Error("Undefined tile config for creating a tile. Adding an empty tile.")),e=ce),!t&&e.createMeta&&(t=e.createMeta()),{id:Object(s.a)(),config:e,effects:{},data:{spinValue:0,totalSpins:0,totalAppearances:0,highlight:!1},meta:null!==(a=t)&&void 0!==a?a:{}}}function ge(e){var t=e.tile,a=e.showValue,n=e.onClick,i=["tile"];return t.data.highlight&&i.push("highlight"),Object(D.jsxs)("div",{className:i.join(" "),onClick:function(){k.state.selectedTile=t,k.update(),n&&n(t)},children:[!!t.config.topStat&&a&&Object(D.jsx)("div",{className:"top-stat",children:t.config.topStat(t)}),!!t.data.spinValue&&a&&Object(D.jsx)("div",{className:"value",children:t.data.spinValue}),Object(D.jsx)(t.config.icon,{})]})}function je(e){var t=e.boardTiles,a=e.gameTiles,n=e.width,i=e.height,c={fontSize:"1.5em",gridTemplateColumns:"repeat(".concat(n,", 5em)"),gridTemplateRows:"repeat(".concat(i,", 5em)")};if(0===t.length){var r=fe(ce);return Object(D.jsx)("div",{className:"board",style:c,children:" ".repeat(n*i).split("").map((function(e,t){return Object(D.jsx)(ge,{tile:r},t)}))})}return Object(D.jsx)("div",{className:"board",style:c,children:t.map((function(e,t){var n=a[e];return Object(D.jsx)(ge,{tile:n,showValue:!0,onClick:function(){}},n.id)}))})}function me(e){var t=e.tiles,a=e.onClickTile;return Object(D.jsx)("div",{className:"inventory",children:t.map((function(e){return Object(D.jsx)(ge,{tile:e,onClick:a},e.id)}))})}function be(e){var t=ue(e);!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=k.state.gameData.ownedTiles;if(_(t,e.id))console.log("Already own tile ".concat(e.name));else{console.log("Adding owned tile ".concat(e.name));var a=fe(e);t.push(a)}}(t),function(e){if(e){var t=k.state.gameData.deckTileIds;t.includes(e)||t.push(e)}}(null===t||void 0===t?void 0:t.id)}function he(){k.state.gameData={boardTiles:[],ownedTiles:[],deckTileIds:[],deckTiles:[],gameTiles:[],gridWidth:3,gridHeight:3,boardValue:0,totalCoins:0,currentTaxPeriod:0,currentTaxPeriodDay:0,roundEnded:!1,events:[]},be("Coal"),be("Dagger"),be("Pickaxe"),be("Rock"),function(){var e=k.state.gameData,t=e.deckTileIds,a=e.ownedTiles;e.deckTiles=t.map((function(e){return _(a,e)||fe(ce)}))}(),L(),$()}function ve(e){var t=e.tile,a=e.onClick;if(!t)return null;var n=t.config;return Object(D.jsxs)("div",{className:"tile-details",onClick:a,children:[Object(D.jsx)("div",{className:"name",children:n.name}),Object(D.jsx)(t.config.icon,{}),Object(D.jsx)("div",{className:"description",children:n.description&&n.description()})]})}function pe(){var e=k.state.tilesToPick;function t(e){e&&G(e),k.state.tilesToPick=[],k.state.gameData.boardTiles=[],k.update()}return Object(D.jsxs)("div",{className:"pick-a-tile",children:[e.map((function(e){return Object(D.jsx)(ve,{tile:e,onClick:function(){t(e)}},e.id)})),Object(D.jsx)("button",{onClick:function(){return t()},children:"Skip"})]})}re.forEach((function(e){oe.set(e.id,e),le.set(e.name,e),de.push(fe(e))}));var xe=[{id:"bbe17879-f3ee-47fc-9e76-2fa8cc0ebc0d",name:"Board Width",cost:function(){return 0},buy:function(){k.state.gameData.gridWidth+=1,Q(),k.update()},isComplete:function(){return!1}},{id:"1e0ab330-8ec9-4e41-933d-75251ffa5ee5",name:"Board Height",cost:function(){return 0},buy:function(){k.state.gameData.gridHeight+=1,Q(),k.update()},isComplete:function(){return!1}},{id:"0245c559-dd55-4f93-a626-53cc06b17d42",name:"XYZ",cost:function(){return 0},buy:function(){},isComplete:function(){return!1}}];function Oe(){return Object(D.jsx)("div",{className:"upgrades",children:xe.map((function(e){return Object(D.jsxs)("div",{children:[Object(D.jsx)("div",{children:e.name}),Object(D.jsx)("div",{children:Object(D.jsx)("button",{onClick:e.buy,children:"Buy"})})]},e.id)}))})}function ye(e){var t,a=Object(H.a)(e);try{var n=function(){var e=t.value;e.config=se.find((function(t){return t.id===e.config.id}))||ce};for(a.s();!(t=a.n()).done;)n()}catch(i){a.e(i)}finally{a.f()}}function Te(){var e=k.state.gameData;e.currentTaxPeriod=0,e.currentTaxPeriodDay=0,e.roundEnded=!1,e.boardTiles=[],e.totalCoins=0,L(),$(),k.state.tilesToPick=[],k.update()}function ke(e){var t=e.events;return Object(D.jsx)("div",{className:"game-events",children:t.map((function(e){return Object(D.jsx)("div",{className:"event",children:Object(D.jsx)("div",{className:"message",children:e.message})},e.id)}))})}var De=a(9);function Ae(){var e=k.state.gameData,t=U[e.currentTaxPeriod];return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)("div",{style:{fontSize:"3em"},children:[e.totalCoins,Object(D.jsx)("span",{className:"icon-em",children:Object(D.jsx)(P,{})})," ","/ ",t.taxAmount,Object(D.jsx)("span",{className:"icon-em",children:Object(D.jsx)(P,{})})," ","taxes due in ",t.totalDays-e.currentTaxPeriodDay," Days"]}),Object(D.jsx)("div",{style:{fontSize:"3em"}})]})}!function(){var e,t=localStorage["".concat(J)];if(null===(e=t=t?JSON.parse(t):{})||void 0===e?void 0:e.gameState){var a=t.gameState;ye(a.ownedTiles),ye(a.deckTiles),ye(a.gameTiles),k.state.gameData=t.gameState}}();var Ce=function(){var e=Object(n.useState)(0)[1];Object(n.useEffect)((function(){k._update=e}),[e]),k.state.gameData||he();var t=k.state,a=t.gameData,i=t.tilesToPick,c=null;if(k.state.spinning||i.length||(c=Object(D.jsx)(D.Fragment,{children:Object(D.jsx)("button",{onClick:X,children:"Spin"})})),a.roundEnded)return Object(D.jsxs)("div",{children:["THE ROUND IS OVER",Object(D.jsx)("button",{onClick:Te,children:"Next round"})]});var r=function(){var e,t=k.state.gameData,a=0,n=Object(H.a)(t.deckTiles);try{for(n.s();!(e=n.n()).done;)a+=e.value.config.rarity}catch(i){n.e(i)}finally{n.f()}return a/t.deckTiles.length}();return Object(D.jsxs)("div",{className:"app",children:[Object(D.jsxs)("div",{children:["Version: ",De.version]}),Object(D.jsx)(Ae,{}),!!i.length&&Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Pick New Tile"}),Object(D.jsx)(pe,{})]}),Object(D.jsxs)("div",{style:{opacity:i.length?.5:1},children:[Object(D.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Board"}),Object(D.jsx)(je,{boardTiles:a.boardTiles,gameTiles:a.gameTiles,width:a.gridWidth,height:a.gridHeight}),c,Object(D.jsxs)("div",{style:{fontSize:"2em"},children:["Board value:"," ",Object(D.jsx)("b",{children:!!a.boardValue&&a.boardValue||0})]})]}),Object(D.jsx)("div",{style:{width:"1em"}}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Selected Tile"}),Object(D.jsx)(ve,{tile:k.state.selectedTile})]}),Object(D.jsx)("div",{style:{width:"1em"}}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Events"}),Object(D.jsx)(ke,{events:a.events})]})]}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Game Tiles"}),Object(D.jsx)(me,{tiles:a.gameTiles})]}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Deck"}),Object(D.jsxs)("div",{style:{background:r>1?"red":"none"},children:["Deck Score: ",r.toFixed(2)]}),Object(D.jsx)(me,{tiles:a.deckTiles,onClickTile:function(e){var t=a.deckTiles.indexOf(e);t>=0&&a.deckTiles.splice(t,1)}})]}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Owned Inventory"}),Object(D.jsx)(me,{tiles:a.ownedTiles,onClickTile:function(e){a.deckTiles.find((function(t){return t.config.id===e.config.id}))||a.deckTiles.push(e)}})]}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"All Tiles"}),Object(D.jsx)(me,{tiles:de,onClickTile:function(e){a.ownedTiles.find((function(t){return t.config.id===e.config.id}))||a.ownedTiles.push(fe(e.config))}})]}),Object(D.jsxs)("div",{children:[Object(D.jsx)("h1",{children:"Upgrades"}),Object(D.jsx)(Oe,{})]}),Object(D.jsx)("button",{onClick:function(){he(),k.update()},children:"Reset all game data"}),Object(D.jsx)("button",{onClick:function(){F()},children:"Save game data"})]})]})};r.a.render(Object(D.jsx)(i.a.StrictMode,{children:Object(D.jsx)(Ce,{})}),document.getElementById("root"))},9:function(e){e.exports=JSON.parse('{"name":"fantasy-slots","version":"0.1.5","private":true,"dependencies":{"gh-pages":"^3.1.0","node-sass":"^5.0.0","react":"^17.0.1","react-dom":"^17.0.1","react-scripts":"4.0.3","typescript":"^4.2.2","uuid":"^8.3.2","web-vitals":"^1.1.0"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm version patch && git push && npm run build","deploy":"gh-pages -d build","sync":"git add . && git commit -m \'Sync\' && git push"},"eslintConfig":{"extends":["react-app","react-app/jest"]},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@testing-library/jest-dom":"^5.11.9","@testing-library/react":"^11.2.5","@testing-library/user-event":"^12.7.3","@types/jest":"^26.0.20","@types/node":"^12.20.4","@types/react":"^17.0.2","@types/react-dom":"^17.0.1","@types/uuid":"^8.3.0"},"homepage":"https://zephren.github.io/fantasy-slots"}')}},[[17,1,2]]]);
//# sourceMappingURL=main.141e0a1a.chunk.js.map